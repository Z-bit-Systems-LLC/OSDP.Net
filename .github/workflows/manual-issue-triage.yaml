name: Manual Issue Triage
on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to triage'
        required: true
        type: number

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for better context
      
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          claude_args: "--allowedTools 'Read,Grep,WebFetch,WebSearch,mcp__github__*'"
          prompt: |
            Analyze GitHub issue #${{ inputs.issue_number }} for the OSDP.Net C# library:
            
            Repository: Z-bit-Systems-LLC/OSDP.Net
            
            Steps:
            1. Fetch issue details from: https://api.github.com/repos/Z-bit-Systems-LLC/OSDP.Net/issues/${{ inputs.issue_number }}
            2. Read the issue content and understand the problem
            3. Search the codebase for relevant C# files using Grep
            4. Categorize as: bug, feature, enhancement, question, or documentation
            5. Assess complexity: simple, moderate, or complex
            6. Assess priority: low, medium, or high
            7. Identify specific C# modules/files affected
            8. Suggest implementation approach
            9. Post a detailed comment on the issue with your analysis
            
            Use the GitHub API to post your comment when done.
